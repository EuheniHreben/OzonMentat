<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>–í–æ—Ä–æ–Ω–∫–∞ –ø–æ SKU (Lite)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>

  <body>
    <header class="header">
      <h1 id="page-title">üìä –í–æ—Ä–æ–Ω–∫–∞ –ø–æ SKU (Lite)</h1>
    </header>

    <!-- –í–µ—Ä—Ö–Ω–∏–π –±–∞—Ä: –≤–∫–ª–∞–¥–∫–∏ + –ø–æ–∏—Å–∫ -->
    <section class="controls">
      <div class="chip-group">
        <button id="tab-funnel" class="chip tab-chip tab-active" type="button">
          –í–æ—Ä–æ–Ω–∫–∞
        </button>
        <button id="tab-loader" class="chip tab-chip" type="button">
          –ü—Ä–æ–≥—Ä—É–∑—á–∏–∫
        </button>
      </div>

      <div class="search-group">
        <input
          id="search-input"
          type="text"
          placeholder="–ü–æ–∏—Å–∫ –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É / SKU (–Ω–∞–ø—Ä–∏–º–µ—Ä: 200 3 20)"
        />
      </div>
    </section>

    <!-- –í—å—é—Ö–∞ –≤–æ—Ä–æ–Ω–∫–∏ -->
    <div id="view-funnel">
      <main class="table-wrapper">
        <!-- –ü–æ–¥—à–∞–ø–∫–∞ –≤–æ—Ä–æ–Ω–∫–∏ -->
        <div id="funnel-header" class="loader-header">
          <div class="loader-left">
            <button
              id="reload-btn"
              class="reload-btn btn-with-progress"
              type="button"
            >
              –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
            </button>

            <div class="chip-group">
              <span class="chip-label">–ü–µ—Ä–∏–æ–¥:</span>
              <button
                class="chip period-chip period-active"
                data-days="7"
                type="button"
              >
                7 –¥–Ω–µ–π
              </button>
              <button class="chip period-chip" data-days="30" type="button">
                30 –¥–Ω–µ–π
              </button>
            </div>

            <div class="chip-group">
              <span class="chip-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</span>
              <button
                class="chip priority-chip priority-active"
                data-prio="all"
                type="button"
              >
                –í—Å–µ
              </button>
              <button
                class="chip priority-chip"
                data-prio="–≤—ã—Å–æ–∫–∏–π"
                type="button"
              >
                –í—ã—Å–æ–∫–∏–π
              </button>
              <button
                class="chip priority-chip"
                data-prio="—Å—Ä–µ–¥–Ω–∏–π"
                type="button"
              >
                –°—Ä–µ–¥–Ω–∏–π
              </button>
              <button
                class="chip priority-chip"
                data-prio="–Ω–∏–∑–∫–∏–π"
                type="button"
              >
                –ù–∏–∑–∫–∏–π
              </button>
            </div>
          </div>
        </div>
        <table id="funnel-table" class="funnel-table">
          <thead>
            <tr>
              <th>#</th>
              <th class="sortable" data-field="offer_id">–ê—Ä—Ç–∏–∫—É–ª</th>
              <th class="sortable" data-field="impressions">–ü–æ–∫–∞–∑—ã</th>
              <th class="sortable" data-field="clicks">–ö–ª–∏–∫–∏</th>
              <th class="sortable" data-field="ctr">CTR %</th>
              <th class="sortable" data-field="orders">–ó–∞–∫–∞–∑—ã</th>
              <th class="sortable" data-field="conv">–ö–æ–Ω–≤. %</th>
              <th class="sortable" data-field="revenue">–í—ã—Ä—É—á–∫–∞</th>
              <th class="sortable" data-field="ad_spend">–†–µ–∫–ª–∞–º–∞</th>
              <th class="sortable" data-field="drr">DRR %</th>
              <th class="sortable" data-field="avg_check">–ß–µ–∫</th>
              <th class="sortable" data-field="ozon_stock">–û—Å—Ç–∞—Ç–∫–∏</th>
              <th class="sortable" data-field="returns">–í–æ–∑–≤—Ä–∞—Ç—ã</th>
              <th class="sortable" data-field="refund_rate">–í–æ–∑–≤—Ä–∞—Ç—ã %</th>
              <th>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </main>
    </div>

    <!-- –í—å—é—Ö–∞ –ø—Ä–æ–≥—Ä—É–∑—á–∏–∫–∞ -->
    <div id="view-loader" class="hidden">
      <main class="table-wrapper">
        <div class="loader-header">
          <div class="loader-left">
            <button
              id="loader-run"
              class="reload-btn loader-btn btn-with-progress"
              type="button"
            >
              <span>–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≥—Ä—É–∑–∫—É</span>
            </button>

            <span id="loader-status" class="loader-status"></span>
          </div>

          <button
            id="loader-settings"
            class="icon-btn"
            type="button"
            title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≥—Ä—É–∑—á–∏–∫–∞"
          >
            ‚öôÔ∏è
          </button>
        </div>

        <table id="loader-table" class="funnel-table">
          <thead>
            <tr>
              <th>#</th>
              <th class="sortable" data-field="offer_id">–ê—Ä—Ç–∏–∫—É–ª</th>
              <th>–í —Ä–∞—Å—á—ë—Ç–µ</th>
              <th class="sortable" data-field="orders">–ó–∞–∫–∞–∑—ã</th>
              <th class="sortable" data-field="revenue">–í—ã—Ä—É—á–∫–∞</th>
              <th class="sortable" data-field="ozon_stock">–û—Å—Ç–∞—Ç–∫–∏</th>
              <th class="sortable" data-field="in_transit">–í –ø—É—Ç–∏</th>
              <th class="sortable" data-field="week_sales_raw">
                –ü—Ä–æ–¥–∞–∂–∏ (–∫–æ—Ä–æ—Ç–∫–∏–π)
              </th>
              <th class="sortable" data-field="week_sales_long_raw">
                –ü—Ä–æ–¥–∞–∂–∏ (–¥–ª–∏–Ω–Ω—ã–π)
              </th>
              <th class="sortable" data-field="week_sales_effective">
                –°–≥–ª–∞–∂–µ–Ω–æ
              </th>
              <th class="sortable" data-field="target_demand">–¶–µ–ª—å —Å–ø—Ä–æ—Å–∞</th>
              <th class="sortable" data-field="demand_factor">–ö—ç—Ñ—Ñ. —Å–ø—Ä–æ—Å–∞</th>
              <th class="sortable" data-field="need_raw">–†–∞—Å—á—ë—Ç</th>
              <th class="sortable" data-field="NeedGoods">–ü–æ—Å—Ç–∞–≤–∫–∞</th>
            </tr>
          </thead>

          <tbody></tbody>
        </table>
      </main>
    </div>

    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å (–¥–ª—è –≤–æ—Ä–æ–Ω–∫–∏) -->
    <aside id="details-panel" class="details-panel">
      <div class="details-header">
        <h2 id="details-title">‚Äî</h2>
        <button id="details-close" class="close-btn">‚úï</button>
      </div>

      <div class="details-content">
        <p><strong>–ü–µ—Ä–∏–æ–¥:</strong> <span id="d-period"></span></p>

        <h3>‚ö° –ú–µ—Ç—Ä–∏–∫–∏</h3>
        <ul class="metrics-list">
          <li>
            <strong>–ü–æ–∫–∞–∑—ã:</strong>
            <span id="d-imp"></span>
          </li>
          <li>
            <strong>–ö–ª–∏–∫–∏:</strong>
            <span id="d-clicks"></span>
          </li>
          <li>
            <strong>CTR:</strong>
            <span id="d-ctr"></span>
          </li>
          <li>
            <strong>–ó–∞–∫–∞–∑—ã:</strong>
            <span id="d-orders"></span>
            <small id="d-orders-delta" class="metric-delta"></small>
          </li>
          <li>
            <strong>–ö–æ–Ω–≤–µ—Ä—Å–∏—è:</strong>
            <span id="d-conv"></span>
          </li>
          <li>
            <strong>–í—ã—Ä—É—á–∫–∞:</strong>
            <span id="d-revenue"></span>
            <small id="d-revenue-delta" class="metric-delta"></small>
          </li>
          <li>
            <strong>DRR:</strong>
            <span id="d-drr"></span>
          </li>
          <li>
            <strong>–û—Å—Ç–∞—Ç–∫–∏:</strong>
            <span id="d-stock"></span>
          </li>
          <li>
            <strong>–í–æ–∑–≤—Ä–∞—Ç—ã:</strong>
            <span id="d-returns"></span>
          </li>
          <li>
            <strong>–í–æ–∑–≤—Ä–∞—Ç—ã %:</strong>
            <span id="d-refund"></span>
            <small id="d-refund-delta" class="metric-delta"></small>
          </li>
          <li>
            <strong>–ú–∏–Ω. –ø–∞—Ä—Ç–∏—è:</strong>
            <input
              id="d-min-batch"
              class="min-batch-input"
              type="number"
              min="0"
              step="1"
            />
          </li>
        </ul>

        <h3>ü©∫ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h3>
        <p id="d-diagnosis"></p>

        <h3>üéØ –°–æ–≤–µ—Ç</h3>
        <p id="d-rec"></p>

        <h3>üìä –°—Ä–µ–∑ –ø–æ SKU</h3>
        <div class="chart-container chart-bottom">
          <canvas id="sku-chart"></canvas>
        </div>
      </div>
    </aside>

    <!-- –ú–æ–¥–∞–ª–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–æ–≥—Ä—É–∑—á–∏–∫–∞ -->
    <div id="config-modal" class="modal hidden">
      <div id="config-backdrop" class="modal-backdrop"></div>
      <div class="modal-dialog">
        <div class="modal-header">
          <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≥—Ä—É–∑—á–∏–∫–∞</h2>
          <button id="config-close" class="close-btn">‚úï</button>
        </div>
        <div class="modal-body">
          <div class="modal-grid">
            <label>
              –ö–æ—ç—Ñ. —Å–ø—Ä–æ—Å–∞ (DEMAND_FACTOR)
              <input id="cfg-demand" type="number" step="0.1" min="0" />
            </label>
            <label>
              –ü–µ—Ä–∏–æ–¥ –ø—Ä–æ–¥–∞–∂ 1 (DAYS)
              <input id="cfg-days" type="number" step="1" min="1" />
            </label>
            <label>
              –ü–µ—Ä–∏–æ–¥ –ø—Ä–æ–¥–∞–∂ 2 (DAYS_LONG)
              <input id="cfg-days-long" type="number" step="1" min="1" />
            </label>
            <label>
              –ú–∏–Ω. –∑–∞–ø–∞—Å (MIN_STOCK)
              <input id="cfg-min-stock" type="number" step="1" min="0" />
            </label>
            <label>
              –†–∞–∑–º–µ—Ä —É–ø–∞–∫–æ–≤–∫–∏ (PACK_SIZE)
              <input id="cfg-pack-size" type="number" step="1" min="1" />
            </label>
            <label>
              –°–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ (ALPHA)
              <input id="cfg-alpha" type="number" step="0.05" min="0" max="1" />
            </label>
            <label>
              –ú–Ω–æ–∂–∏—Ç–µ–ª—å –≤—Å–ø–ª–µ—Å–∫–∞
              <input id="cfg-spike-mult" type="number" step="0.5" min="0" />
            </label>
            <label>
              –õ–∏–º–∏—Ç –≤—Å–ø–ª–µ—Å–∫–∞
              <input id="cfg-spike-cap" type="number" step="0.1" min="0" />
            </label>
            <label>
              –ú–∞–∫—Å. –¥–Ω–µ–π –∑–∞–ø–∞—Å–∞
              <input id="cfg-max-days" type="number" step="1" min="1" />
            </label>
            <label>
              –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≥—Ä—É–∑–æ–∫ (–¥–Ω–µ–π)
              <input
                id="cfg-max-loader-history"
                type="number"
                step="1"
                min="1"
              />
            </label>
            <label>
              –ò—Å—Ç–æ—Ä–∏—è –≤–æ—Ä–æ–Ω–∫–∏ (–¥–Ω–µ–π)
              <input
                id="cfg-max-funnel-history"
                type="number"
                step="1"
                min="1"
              />
            </label>
          </div>
          <p class="modal-hint">
            –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –Ω–æ–≤—ã–π —Ä–∞—Å—á—ë—Ç –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏
            –∑–Ω–∞—á–µ–Ω–∏—è. –ö–æ–Ω—Ñ–∏–≥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ <code>loaderConfig.json</code>.
          </p>
        </div>
        <div class="modal-footer">
          <button id="config-save" class="reload-btn" type="button">
            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
          </button>
        </div>
      </div>
    </div>
    <script src="/dataService.js"></script>
    <script src="/store.js"></script>
    <script src="/app.js"></script>
  </body>
</html>
